<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Explore detailed information about TV shows including ratings, reviews, cast, crew, trailers and where to watch on CineRank.">
  <meta name="keywords" content="TV shows, series, episodes, cast, ratings, reviews, streaming, watch online">
  <meta name="author" content="CineRank">
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <link rel="canonical" href="https://cinerank.com/tv-details.html">
  <meta property="og:title" content="TV Show Details - CineRank">
  <meta property="og:description" content="Detailed information about your favorite TV shows with ratings, reviews, and streaming options.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <title>TV Show Details - CineRank</title>
  <!-- JSON-LD Schema for TV Series -->
  <script type="application/ld+json" id="tvSchema">
  {
    "@context": "https://schema.org",
    "@type": "TVSeries",
    "name": "TV Show Title",
    "description": "TV show description will be populated dynamically",
    "image": "https://image.tmdb.org/t/p/w500/poster.jpg",
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "8.0",
      "bestRating": "10",
      "worstRating": "0",
      "ratingCount": "1000"
    },
    "url": "https://cinerank.com/tv-details.html",
    "numberOfSeasons": 5,
    "numberOfEpisodes": 50,
    "potentialAction": {
      "@type": "WatchAction",
      "target": {
        "@type": "EntryPoint",
        "name": "Watch on Streaming Service"
      }
    }
  }
  </script>
  <style>
    /* Reuse styles from movie-details but scoped for TV details */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; color: #f5f5f5; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: 100vh; }
    header { background: linear-gradient(to bottom, rgba(0,0,0,0.98), rgba(0,0,0,0.85)); padding: 14px 18px; position: sticky; top: 0; z-index: 100; box-shadow: 0 12px 30px rgba(0,0,0,0.9); border-bottom: 1px solid rgba(255,255,255,0.08); }
    .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; gap: 16px; }
    h1 { font-size: clamp(1.1rem, 3vw, 1.5rem); font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer; }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-mark { width: 26px; height: 26px; border-radius: 6px; background: linear-gradient(135deg, #e50914, #b20710); display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; color: #fff; }
    .back-btn { background: #181818; color: #f5f5f5; padding: 8px 16px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.25); cursor: pointer; transition: background 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease; font-size: 0.9rem; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .tabs { display:flex; gap:10px; margin-bottom:30px; overflow-x:auto; padding:10px 0; scrollbar-width:none; -ms-overflow-style:none; }
    .tabs::-webkit-scrollbar{ display:none; }
    .tab { padding:12px 30px; border-radius:25px; background: rgba(255,255,255,0.1); cursor:pointer; transition:all .3s; white-space:nowrap; border:2px solid transparent; display:flex; align-items:center; gap:8px; }
    .tab.active { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-color:#ffd700; }
    .tab-content { display:none; }
    .tab-content.active { display:block; animation: fadeIn .5s; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }
    .movie-hero { background: radial-gradient(circle at top left, #2b2b2b 0, #141414 45%, #050505 100%); border-radius:14px; padding:24px; margin-bottom:28px; display:flex; gap:24px; flex-wrap:wrap; }
    .movie-poster img { width:220px; border-radius:10px; box-shadow:0 18px 36px rgba(0,0,0,0.9); }
    .movie-info { flex:1; min-width:250px; }
    .movie-info h2 { font-size: clamp(1.6rem,4.5vw,2.4rem); margin-bottom:10px; }
    .movie-meta { display:flex; gap:20px; margin-bottom:15px; flex-wrap:wrap; }
    .meta-item { display:flex; align-items:center; gap:5px; font-size:1rem; }
    .movie-overview { line-height:1.8; opacity:0.9; }
    .cast-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap:20px; }
    .cast-card { background: rgba(255,255,255,0.05); border-radius:15px; padding:15px; text-align:center; transition:all .3s; border:1px solid rgba(255,255,255,0.1); cursor:pointer; }
    .cast-card img { width:100px; height:100px; border-radius:50%; object-fit:cover; margin-bottom:10px; border:3px solid #ffd700; }
    .related-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(140px,1fr)); gap:16px; padding:0 16px; }
    .related-card { background:#181818; border-radius:6px; overflow:hidden; cursor:pointer; transition:transform 0.25s ease, box-shadow 0.25s ease; position:relative; aspect-ratio:2/3; }
    .related-card:hover { transform:translateY(-6px) scale(1.03); box-shadow:0 18px 30px rgba(0,0,0,0.7); }
    .related-card img { width:100%; height:100%; object-fit:cover; display:block; border-radius:6px; }
    .providers-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(80px,1fr)); gap:15px; overflow-x:auto; scrollbar-width:none; -ms-overflow-style:none; }
    .providers-grid::-webkit-scrollbar{ display:none; }
    .provider-logo { display:flex; flex-direction:column; align-items:center; gap:10px; padding:15px; background: rgba(102,126,234,0.1); border-radius:10px; border:1px solid rgba(255,215,0,0.3); }
    .provider-logo img { width:60px; height:60px; border-radius:8px; object-fit:cover; }
    .loader { text-align:center; padding:60px 20px; font-size:1.2rem; }
    .no-data { text-align:center; padding:60px 20px; opacity:0.6; font-size:1.1rem; }
    
    /* Modal, actor and media cards (same as movie-details) */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }

    .modal.hidden { display: none; }

    .modal-content {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      width: 100%;
      max-width: 1000px;
      border-radius: 20px;
      padding: 0;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      position: sticky;
      top: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      padding: 20px;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title { font-size: clamp(1.3rem, 4vw, 1.8rem); color: #ffd700; margin: 0; }

    .close-btn {
      background: none; border: none; color: #ffd700; font-size: 32px; cursor: pointer; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;
    }

    .close-btn:hover { background: rgba(255, 215, 0, 0.2); transform: rotate(90deg); }

    .modal-body { padding: 20px; }

    .actor-info { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
    .actor-photo img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #ffd700; }
    .actor-details { flex: 1; min-width: 250px; }
    .actor-details h3 { font-size: 1.5rem; margin-bottom: 10px; color: #ffd700; }
    .actor-bio { line-height: 1.8; opacity: 0.9; margin-bottom: 15px; }

    .movies-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }

    .movie-card { background: rgba(255, 255, 255, 0.05); border-radius: 10px; overflow: hidden; transition: all 0.3s; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; }
    .movie-card:hover { transform: translateY(-5px); border-color: #ffd700; background: rgba(255,255,255,0.1); }
    .movie-card img { width: 100%; height: 280px; object-fit: cover; }
    .movie-card-info { padding: 10px; }
    .movie-card-title { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-clamp: 2; overflow: hidden; }
    .movie-card-year { font-size: 0.8rem; opacity: 0.7; }

    .trailer-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .trailer-card { background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
    .trailer-card iframe { width: 100%; height: 250px; border: none; }
    .trailer-info { padding: 15px; }
    .trailer-title { font-weight: bold; margin-bottom: 5px; }
    .trailer-type { font-size: 0.85rem; color: #ffd700; }

    .reviews-container { display: flex; flex-direction: column; gap: 20px; }
    .review-card { background: #181818; border-radius: 12px; padding: 16px 18px; border-left: 3px solid #e50914; }
    .review-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px; }
    .review-author { font-weight: bold; color: #ffd700; font-size: 1.1rem; }
    .review-rating { background: rgba(255,215,0,0.2); padding:5px 15px; border-radius:20px; font-weight:bold; }
    .review-content { line-height:1.8; opacity:0.9; }
    .review-date { font-size:0.85rem; opacity:0.6; margin-top:10px; }
    .read-more { color:#ffd700; cursor:pointer; font-weight:bold; display:inline-block; margin-top:10px; }
    .read-more:hover { text-decoration: underline; }

  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="brand" onclick="goBack()" style="cursor: pointer;">
        <div class="brand-mark">C</div>
        <h1>CineRank</h1>
      </div>
      <button class="back-btn" onclick="goBack()">‚Üê Back to TV Shows</button>
    </div>
  </header>

  <div class="container">
    <div id="showHero"></div>

    <div class="tabs">
      <div class="tab active" data-tab="related">Related</div>
      <div class="tab" data-tab="cast">Cast</div>
      <div class="tab" data-tab="watch">Watch</div>
      <div class="tab" data-tab="trailers">Trailers</div>
      <div class="tab" data-tab="reviews">Reviews</div>
    </div>

    <div id="related" class="tab-content active">
      <div class="related-grid" id="relatedGrid"></div>
      <div id="relatedLoadMore" style="text-align: center; margin-top: 30px;"></div>
      <div id="relatedSentinel" style="height: 20px; margin-top: 20px;"></div>
    </div>

    <div id="cast" class="tab-content">
      <div id="directors"></div>
      <div class="cast-grid" id="castGrid"></div>
    </div>

    <div id="watch" class="tab-content">
      <div class="providers-container" id="providersContainer"></div>
    </div>

    <div id="trailers" class="tab-content">
      <div class="trailer-container" id="trailersContainer"></div>
    </div>

    <div id="reviews" class="tab-content">
      <div class="reviews-container" id="reviewsContainer"></div>
    </div>
  </div>

<script>
const API_KEY = "2c6c0c3b3185da46b0f55233341d4b98";
const BASE = "https://api.themoviedb.org/3";
const IMG = "https://image.tmdb.org/t/p/w500";

let currentShowId;

function goBack() { window.location.href = 'index.html'; }

function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
  document.getElementById(tabName).classList.add('active');
}

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function() { switchTab(this.getAttribute('data-tab')); });
  });

  const savedId = localStorage.getItem('selectedTVShowId');
  if (savedId) {
    loadTVDetails(savedId);
  } else {
    // Fallback show: Breaking Bad (1396) if none saved
    loadTVDetails(1396);
  }
});

function loadTVDetails(showId) {
  currentShowId = showId;
  window.scrollTo(0,0);
  document.getElementById('showHero').innerHTML = '<div class="loader">Loading show details...</div>';

  fetch(`${BASE}/tv/${showId}?api_key=${API_KEY}&language=en-US`)
    .then(r => r.json())
    .then(show => {
      const title = show.name || show.original_name || 'Untitled';
      const firstAir = show.first_air_date ? show.first_air_date.substring(0,4) : 'N/A';
      const seasons = show.number_of_seasons ? show.number_of_seasons : 'N/A';
      const runtime = (show.episode_run_time && show.episode_run_time.length) ? show.episode_run_time[0] + ' min' : 'N/A';
      const backdropUrl = show.backdrop_path ? IMG + show.backdrop_path : '';
      const backdropStyle = backdropUrl ? `background-image: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 100%), url('${backdropUrl}'); background-size: cover; background-position: center;` : '';

      document.getElementById('showHero').innerHTML = `
        <div class="movie-hero" style="${backdropStyle}">
          <div class="movie-poster">
            <img src="${show.poster_path ? IMG + show.poster_path : 'https://via.placeholder.com/200x300/667eea/ffffff?text=No+Image'}" alt="${title}">
          </div>
          <div class="movie-info">
            <h2>${title}</h2>
            <div class="movie-meta">
              <div class="meta-item">‚≠ê ${show.vote_average ? show.vote_average.toFixed(1) : 'N/A'}/10</div>
              <div class="meta-item">üìÖ ${firstAir}</div>
              <div class="meta-item">üéûÔ∏è ${seasons} seasons</div>
              <div class="meta-item">‚è±Ô∏è ${runtime}</div>
            </div>
            <p class="movie-overview">${show.overview || 'No overview available.'}</p>
          </div>
        </div>
      `;
      loadRelated(showId, show.genres);
    })
    .catch(err => {
      document.getElementById('showHero').innerHTML = '<div class="loader">Error loading show details</div>';
    });

  loadCast(showId);
  loadTrailers(showId);
  loadReviews(showId);
  loadWatchProviders(showId);
}

let relatedShowsState = { all: [], displayed: 0 };

function loadRelated(showId, genres) {
  document.getElementById('relatedGrid').innerHTML = '<div class="loader">Loading related shows...</div>';
  document.getElementById('relatedLoadMore').innerHTML = '';
  
  if (!genres || genres.length === 0) {
    document.getElementById('relatedGrid').innerHTML = '<div class="no-data">No related content available</div>';
    return;
  }
  
  const genreIds = genres.map(g => g.id).join(',');
  
  fetch(`${BASE}/discover/tv?api_key=${API_KEY}&with_genres=${genreIds}&sort_by=popularity.desc&page=1`)
    .then(r => r.json())
    .then(data => {
      relatedShowsState.all = data.results.filter(s => s.id !== showId && s.poster_path);
      relatedShowsState.displayed = 0;
      
      if (relatedShowsState.all.length === 0) {
        document.getElementById('relatedGrid').innerHTML = '<div class="no-data">No related shows found</div>';
        return;
      }
      
      displayMoreRelated('tv');
    })
    .catch(err => {
      document.getElementById('relatedGrid').innerHTML = '<div class="loader">Error loading related shows</div>';
    });
}

function displayMoreRelated(type) {
  const state = type === 'tv' ? relatedShowsState : relatedMoviesState;
  const itemsPerLoad = 10;
  const maxItems = 50;
  const newItems = state.all.slice(state.displayed, state.displayed + itemsPerLoad);
  
  if (newItems.length === 0) return;
  
  const html = newItems.map(item => {
    const id = item.id;
    const poster = item.poster_path;
    const title = item.title || item.name;
    
    return `
      <div class="related-card" onclick="selectShow(${id})">
        <img src="${IMG + poster}" alt="${title}">
      </div>
    `;
  }).join('');
  
  if (state.displayed === 0) {
    document.getElementById('relatedGrid').innerHTML = html;
  } else {
    document.getElementById('relatedGrid').innerHTML += html;
  }
  
  state.displayed += itemsPerLoad;
  
  document.getElementById('relatedLoadMore').innerHTML = '';
  
  if (state.displayed < Math.min(state.all.length, maxItems)) {
    setupRelatedIntersectionObserver('tv');
  }
}

function setupRelatedIntersectionObserver(type) {
  const sentinel = document.getElementById('relatedSentinel');
  if (!sentinel) return;
  
  const existingObserver = window.relatedObserver;
  if (existingObserver) {
    existingObserver.disconnect();
  }
  
  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting) {
      const state = type === 'tv' ? relatedShowsState : relatedMoviesState;
      if (state.displayed < state.all.length) {
        displayMoreRelated(type);
      }
    }
  }, { threshold: 0.1 });
  
  observer.observe(sentinel);
  window.relatedObserver = observer;
}

function loadCast(showId) {
  document.getElementById('castGrid').innerHTML = '<div class="loader">Loading cast...</div>';
  document.getElementById('directors').innerHTML = '';

  fetch(`${BASE}/tv/${showId}/credits?api_key=${API_KEY}&language=en-US`)
    .then(r => r.json())
    .then(data => {
      const creators = data.crew ? data.crew.filter(c => c.job === 'Creator' || c.job === 'Director') : [];
      if (creators.length > 0) {
        document.getElementById('directors').innerHTML = `
          <h3 style="margin-bottom:20px;">Creators</h3>
          <div class="cast-grid" style="margin-bottom:30px;">
            ${creators.map(person => {
              const safeName = person.name.replace(/'/g, "&#39;").replace(/\"/g, '&quot;');
              return `
                <div class="cast-card" onclick="showActorCredits(${person.id}, '${safeName}')">
                  <img src="${person.profile_path ? IMG + person.profile_path : 'https://via.placeholder.com/100/667eea/ffffff?text=' + person.name.charAt(0)}" alt="${person.name}">
                  <div class="cast-name">${person.name}</div>
                  <div class="cast-character">${person.job || 'Creator'}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      const cast = (data.cast || []).slice(0,20);
      if (cast.length === 0) {
        document.getElementById('castGrid').innerHTML = '<div class="no-data">No cast information available</div>';
        return;
      }

      document.getElementById('castGrid').innerHTML = cast.map(person => {
        const safeName = person.name.replace(/'/g, "&#39;").replace(/\"/g, '&quot;');
        return `
          <div class="cast-card" onclick="showActorCredits(${person.id}, '${safeName}')">
            <img src="${person.profile_path ? IMG + person.profile_path : 'https://via.placeholder.com/100/667eea/ffffff?text=' + person.name.charAt(0)}" alt="${person.name}">
            <div class="cast-name">${person.name}</div>
            <div class="cast-character">${person.character || 'Unknown role'}</div>
          </div>
        `;
      }).join('');
    })
    .catch(err => {
      document.getElementById('castGrid').innerHTML = '<div class="loader">Error loading cast</div>';
    });
}

function loadTrailers(showId) {
  document.getElementById('trailersContainer').innerHTML = '<div class="loader">Loading trailers...</div>';

  fetch(`${BASE}/tv/${showId}/videos?api_key=${API_KEY}&language=en-US`)
    .then(r => r.json())
    .then(data => {
      const videos = (data.results || []).filter(v => v.site === 'YouTube');
      if (videos.length === 0) {
        document.getElementById('trailersContainer').innerHTML = '<div class="no-data">No trailers available</div>';
        return;
      }

      document.getElementById('trailersContainer').innerHTML = videos.map(video => `
        <div class="trailer-card">
          <iframe src="https://www.youtube.com/embed/${video.key}" allowfullscreen></iframe>
          <div class="trailer-info">
            <div class="trailer-title">${video.name}</div>
            <div class="trailer-type">${video.type}${video.size ? ' ‚Ä¢ ' + video.size + 'p' : ''}</div>
          </div>
        </div>
      `).join('');
    })
    .catch(err => {
      document.getElementById('trailersContainer').innerHTML = '<div class="loader">Error loading trailers</div>';
    });
}

function loadWatchProviders(showId) {
  document.getElementById('providersContainer').innerHTML = '<div class="loader">Loading watch providers...</div>';

  fetch(`${BASE}/tv/${showId}/watch/providers?api_key=${API_KEY}`)
    .then(r => r.json())
    .then(data => {
      const results = data.results;
      if (!results || Object.keys(results).length === 0) {
        document.getElementById('providersContainer').innerHTML = '<div class="no-data">No watch provider information available</div>';
        return;
      }

      const usProviders = results['US'];
      const region = usProviders ? 'US' : Object.keys(results)[0];
      const providers = results[region];

      let html = ``;
      if (providers.flatrate && providers.flatrate.length > 0) {
        html += `
          <div class="provider-section">
            <h3>üé¨ Stream Now</h3>
            <div class="providers-grid">
              ${providers.flatrate.map(provider => `
                <div class="provider-logo">
                  <img src="${IMG + provider.logo_path}" alt="${provider.provider_name}" title="${provider.provider_name}">
                  <div class="provider-name">${provider.provider_name}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (providers.rent && providers.rent.length > 0) {
        html += `
          <div class="provider-section">
            <h3>üé´ Rent</h3>
            <div class="providers-grid">
              ${providers.rent.map(provider => `
                <div class="provider-logo">
                  <img src="${IMG + provider.logo_path}" alt="${provider.provider_name}" title="${provider.provider_name}">
                  <div class="provider-name">${provider.provider_name}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (providers.buy && providers.buy.length > 0) {
        html += `
          <div class="provider-section">
            <h3>üí≥ Buy</h3>
            <div class="providers-grid">
              ${providers.buy.map(provider => `
                <div class="provider-logo">
                  <img src="${IMG + provider.logo_path}" alt="${provider.provider_name}" title="${provider.provider_name}">
                  <div class="provider-name">${provider.provider_name}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (providers.link) {
        html += `<div style="text-align:center; margin-top:20px;"><a href="${providers.link}" target="_blank" style="color:#ffd700; text-decoration:underline; font-weight:bold;">View on JustWatch ‚Üí</a></div>`;
      }

      document.getElementById('providersContainer').innerHTML = html;
    })
    .catch(err => {
      document.getElementById('providersContainer').innerHTML = '<div class="no-data">Watch provider information unavailable</div>';
    });
}

function loadReviews(showId) {
  document.getElementById('reviewsContainer').innerHTML = '<div class="loader">Loading reviews...</div>';

  fetch(`${BASE}/tv/${showId}/reviews?api_key=${API_KEY}&language=en-US`)
    .then(r => r.json())
    .then(data => {
      const reviews = data.results || [];
      if (reviews.length === 0) {
        document.getElementById('reviewsContainer').innerHTML = '<div class="no-data">No reviews available yet</div>';
        return;
      }

      document.getElementById('reviewsContainer').innerHTML = reviews.map(review => {
        const shortContent = review.content.substring(0,400);
        const needsReadMore = review.content.length > 400;
        return `
          <div class="review-card">
            <div class="review-header">
              <div class="review-author">${review.author}</div>
              ${review.author_details?.rating ? `<div class="review-rating">‚≠ê ${review.author_details.rating}/10</div>` : ''}
            </div>
            <div class="review-content">
              <span class="review-text-${review.id}">${shortContent}${needsReadMore ? '...' : ''}</span>
              ${needsReadMore ? `<span class="review-full-${review.id}" style="display:none;">${review.content}</span><span class="read-more" onclick="toggleReview('${review.id}')">Read more</span>` : ''}
            </div>
            <div class="review-date">Posted on ${new Date(review.created_at).toLocaleDateString()}</div>
          </div>
        `;
      }).join('');
    })
    .catch(err => {
      document.getElementById('reviewsContainer').innerHTML = '<div class="loader">Error loading reviews</div>';
    });
}

function showActorCredits(actorId, actorName) {
  // Open modal-like simple list: reuse window.alert if no modal present, but keep minimal
  // For simplicity, fetch combined credits and show top items in a new window-like modal
  const modalHtml = '<div class="loader">Loading actor credits...</div>';
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.innerHTML = `\n    <div class="modal-content">\n      <div class="modal-header">\n        <h2 class="modal-title">${actorName}</h2>\n        <button class="close-btn">√ó</button>\n      </div>\n      <div class="modal-body">${modalHtml}</div>\n    </div>`;
  document.body.appendChild(modal);

  modal.querySelector('.close-btn').addEventListener('click', () => { document.body.removeChild(modal); });
  modal.addEventListener('click', (e) => { if (e.target === modal) document.body.removeChild(modal); });

  Promise.all([
    fetch(`${BASE}/person/${actorId}?api_key=${API_KEY}&language=en-US`).then(r => r.json()),
    fetch(`${BASE}/person/${actorId}/combined_credits?api_key=${API_KEY}&language=en-US`).then(r => r.json())
  ]).then(([actorDetails, credits]) => {
    const items = (credits.cast || []).sort((a,b) => (b.popularity||0)-(a.popularity||0)).slice(0,20);
    const body = modal.querySelector('.modal-body');
    body.innerHTML = `\n      <div class="actor-info">\n        <div class="actor-photo">\n          <img src="${actorDetails.profile_path ? IMG + actorDetails.profile_path : 'https://via.placeholder.com/150/667eea/ffffff?text=' + actorName.charAt(0)}" alt="${actorName}">\n        </div>\n        <div class="actor-details">\n          <h3>${actorName}</h3>\n          ${actorDetails.birthday ? `<p><strong>Born:</strong> ${actorDetails.birthday}${actorDetails.place_of_birth ? ' in ' + actorDetails.place_of_birth : ''}</p>` : ''}\n          ${actorDetails.biography ? `<p class=\"actor-bio\">${actorDetails.biography.substring(0,300)}${actorDetails.biography.length>300? '...' : ''}</p>` : ''}\n        </div>\n      </div>\n      <h3 style=\"margin-bottom:20px; color:#ffd700;\">Known For (${items.length})</h3>\n      <div class=\"movies-grid\">\n        ${items.map(it => `\n          <div class=\"movie-card\" onclick=\"selectShow(${it.id}, ${it.media_type==='tv'})\">\n            <img src=\"${it.poster_path ? IMG + it.poster_path : (it.backdrop_path ? IMG + it.backdrop_path : 'https://via.placeholder.com/300x450/667eea/ffffff?text=No+Image')}\" alt=\"${it.title||it.name}\">\n            <div class=\"movie-card-info\">\n              <div class=\"movie-card-title\">${it.title||it.name}</div>\n              <div class=\"movie-card-year\">${(it.release_date||it.first_air_date)? (it.release_date||it.first_air_date).substring(0,4) : 'N/A'} ‚Ä¢ ‚≠ê ${it.vote_average?it.vote_average.toFixed(1):'N/A'}</div>\n            </div>\n          </div>\n        `).join('')}\n      </div>\n    `;
  }).catch(err => { modal.querySelector('.modal-body').innerHTML = '<div class="loader">Error loading actor details</div>'; });
}

function selectShow(showId, isTV) {
  if (isTV) {
    localStorage.setItem('selectedTVShowId', showId);
    window.location.reload();
  } else {
    // navigate to movie details page
    localStorage.setItem('selectedMovieId', showId);
    window.location.href = 'movie-details.html';
  }
}

function toggleReview(id) {
  const shortText = document.querySelector(`.review-text-${id}`);
  const fullText = document.querySelector(`.review-full-${id}`);
  const button = event.target;
  if (fullText.style.display === 'none') {
    shortText.style.display = 'none'; fullText.style.display = 'inline'; button.textContent = 'Read less';
  } else { shortText.style.display = 'inline'; fullText.style.display = 'none'; button.textContent = 'Read more'; }
}

// register service worker
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

</script>
</body>
</html>
